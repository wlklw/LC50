<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>專業 LC50 計算工具 - 改進版</title>
    <style>
        /* CSS 樣式 - 美編與排版 */
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 20px auto;
            background-color: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        h2 {
            text-align: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .subtitle {
            text-align: center;
            color: #666;
            font-size: 1.1em;
            margin-bottom: 30px;
        }

        .input-section, .results-section {
            margin-bottom: 25px;
        }
        
        .data-table-description {
            margin-bottom: 15px;
            color: #555;
            font-style: italic;
            background: #f8f9ff;
            padding: 10px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .unit-selector {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
            background: #f8f9ff;
            padding: 15px;
            border-radius: 12px;
            border: 2px solid #e1e8ff;
        }

        #unit-select, #custom-unit-input {
            padding: 12px 16px;
            border-radius: 8px;
            border: 2px solid #e1e8ff;
            font-size: 1em;
            transition: all 0.3s ease;
            background: white;
        }
        #unit-select:focus, #custom-unit-input:focus {
            border-color: #667eea;
            box-shadow: 0 0 15px rgba(102, 126, 234, 0.2);
            outline: none;
            transform: translateY(-2px);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        th, td {
            padding: 15px 18px;
            text-align: left;
            border-bottom: 1px solid #f0f2ff;
        }

        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: bold;
            font-size: 1.1em;
        }

        tr:hover {
            background-color: #f8f9ff;
            transform: scale(1.01);
            transition: all 0.2s ease;
        }

        input[type="number"] {
            width: 85%;
            padding: 10px 12px;
            border: 2px solid #e1e8ff;
            border-radius: 6px;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        input[type="number"]:focus {
            border-color: #667eea;
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.2);
            outline: none;
        }

        .keyboard-focused {
            border-color: #667eea !important;
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.4) !important;
        }

        .paste-info {
            font-size: 0.9em;
            color: #888;
            margin-top: 5px;
        }

        .data-group {
            border: 2px solid #e1e8ff;
            padding: 25px;
            margin-bottom: 30px;
            border-radius: 16px;
            background: linear-gradient(135deg, #f8f9ff 0%, #ffffff 100%);
            position: relative;
            overflow: hidden;
        }
        
        .data-group::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .data-group h3 {
            margin-top: 0;
            color: #4a5568;
            font-size: 1.3em;
            margin-bottom: 15px;
        }
        
        .button {
            padding: 14px 28px;
            border: none;
            border-radius: 12px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
        }

        .button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .button:hover::before {
            left: 100%;
        }

        .primary-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        .primary-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
        }

        .accent-button {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: #fff;
            box-shadow: 0 4px 15px rgba(17, 153, 142, 0.4);
        }
        .accent-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(17, 153, 142, 0.6);
        }

        .secondary-button {
            background: linear-gradient(135deg, #606c88 0%, #3f4c6b 100%);
            color: #fff;
            box-shadow: 0 4px 15px rgba(96, 108, 136, 0.4);
        }
        .secondary-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(96, 108, 136, 0.6);
        }

        .actions {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }
        
        .results-info {
            background: linear-gradient(135deg, #f8f9ff 0%, #ffffff 100%);
            padding: 30px;
            border-radius: 16px;
            text-align: center;
            margin-top: 20px;
            border: 2px solid #e1e8ff;
            position: relative;
            overflow: hidden;
        }
        
        .results-info::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }

        .results-info h3 {
            margin-top: 0;
            color: #2d3748;
            font-size: 1.5em;
        }

        .result-value {
            font-weight: bold;
            color: #e53e3e;
            font-size: 1.3em;
        }

        .confidence-interval {
            font-size: 1em;
            color: #4a5568;
            margin-top: 5px;
        }
        
        .chart-container {
            margin-top: 30px;
            padding: 25px;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9ff 100%);
            border: 2px solid #e1e8ff;
            border-radius: 16px;
            position: relative;
        }
        
        .chart-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .validation-info {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            border: 2px solid #f39c12;
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
        }

        .validation-info h4 {
            margin-top: 0;
            color: #d68910;
        }

        .error-message {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            border: 2px solid #dc3545;
            padding: 15px;
            border-radius: 12px;
            margin-top: 15px;
            color: #721c24;
        }

        .success-message {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            border: 2px solid #28a745;
            padding: 15px;
            border-radius: 12px;
            margin-top: 15px;
            color: #155724;
        }

        .data-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid #e1e8ff;
        }

        .stat-card h5 {
            margin: 0 0 10px 0;
            color: #4a5568;
        }

        .data-groups-config {
            background: linear-gradient(135deg, #f0f8ff 0%, #e6f3ff 100%);
            border: 2px solid #b8daff;
            padding: 20px;
            margin-bottom: 25px;
            border-radius: 16px;
            position: relative;
            overflow: hidden;
        }

        .data-groups-config::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
        }

        .data-groups-config h3 {
            margin-top: 0;
            color: #2c5282;
            font-size: 1.3em;
            margin-bottom: 15px;
        }

        .group-names {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .name-input-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .name-input-group label {
            font-weight: bold;
            color: #4a5568;
            min-width: 80px;
        }

        .name-input-group input {
            flex: 1;
            padding: 10px 12px;
            border: 2px solid #cbd5e0;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s ease;
            background: white;
        }

        .name-input-group input:focus {
            border-color: #007bff;
            box-shadow: 0 0 10px rgba(0, 123, 255, 0.2);
            outline: none;
        }

        .chart-export-section {
            margin-top: 20px;
            text-align: center;
        }

        .chart-export-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .export-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .export-png-btn {
            background: #4CAF50;
            color: white;
        }

        .export-jpg-btn {
            background: #2196F3;
            color: white;
        }

        .export-svg-btn {
            background: #FF9800;
            color: white;
        }

        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body>

    <div class="container">
        <h2>LC50、LC75、LC90 計算工具</h2>
        <p class="subtitle">改進版 - 增強統計驗證與精確計算</p>

        <div class="input-section">
            <div class="unit-selector">
                <label for="unit-select">濃度單位:</label>
                <select id="unit-select">
                    <option value="mg/L">mg/L</option>
                    <option value="ppm">ppm</option>
                    <option value="ppb">ppb</option>
                    <option value="ug/L">μg/L</option>
                    <option value="custom">自訂</option>
                </select>
                <input type="text" id="custom-unit-input" placeholder="輸入自訂單位" style="display: none;">
            </div>

            <div class="data-groups-config">
                <h3>實驗組名稱設定</h3>
                <div class="group-names">
                    <div class="name-input-group">
                        <label for="group1-name">第一組名稱:</label>
                        <input type="text" id="group1-name" value="實驗組 A" placeholder="輸入第一組名稱">
                    </div>
                    <div class="name-input-group">
                        <label for="group2-name">第二組名稱:</label>
                        <input type="text" id="group2-name" value="實驗組 B" placeholder="輸入第二組名稱">
                    </div>
                    <div class="name-input-group">
                        <label for="group3-name">第三組名稱:</label>
                        <input type="text" id="group3-name" value="實驗組 C" placeholder="輸入第三組名稱">
                    </div>
                </div>
            </div>
            
            <div class="data-group">
                <h3 id="group1-title">第一組數據 (實驗組 A)</h3>
                <p class="data-table-description">
                    請輸入您的實驗數據。系統會自動處理極值（0%或100%死亡率）並進行統計驗證。
                    您也可以直接從 Excel 表格複製三欄（濃度、總數、死亡數）到下方表格中。
                    使用方向鍵可以在輸入格之間快速移動。
                </p>
                <table id="data-table-1" class="data-table">
                    <thead>
                        <tr>
                            <th>濃度 (C)</th>
                            <th>總數 (N)</th>
                            <th>死亡數 (D)</th>
                            <th>死亡率 (%)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><input type="number" class="concentration" step="any" tabindex="1"></td>
                            <td><input type="number" class="total" min="1" tabindex="2"></td>
                            <td><input type="number" class="dead" min="0" tabindex="3"></td>
                            <td><span class="mortality-display">--</span></td>
                        </tr>
                    </tbody>
                </table>
                <button id="add-row-btn-1" class="button primary-button">新增數據列</button>
            </div>

            <div class="data-group">
                <h3 id="group2-title">第二組數據 (實驗組 B) - 可選</h3>
                <p class="data-table-description">您可以在此處輸入另一組數據，以便與第一組數據進行比較。</p>
                <table id="data-table-2" class="data-table">
                    <thead>
                        <tr>
                            <th>濃度 (C)</th>
                            <th>總數 (N)</th>
                            <th>死亡數 (D)</th>
                            <th>死亡率 (%)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><input type="number" class="concentration" step="any" tabindex="101"></td>
                            <td><input type="number" class="total" min="1" tabindex="102"></td>
                            <td><input type="number" class="dead" min="0" tabindex="103"></td>
                            <td><span class="mortality-display">--</span></td>
                        </tr>
                    </tbody>
                </table>
                <button id="add-row-btn-2" class="button primary-button">新增數據列</button>
            </div>

            <div class="data-group">
                <h3 id="group3-title">第三組數據 (實驗組 C) - 可選</h3>
                <p class="data-table-description">您可以在此處輸入第三組數據進行三組比較分析。</p>
                <table id="data-table-3" class="data-table">
                    <thead>
                        <tr>
                            <th>濃度 (C)</th>
                            <th>總數 (N)</th>
                            <th>死亡數 (D)</th>
                            <th>死亡率 (%)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><input type="number" class="concentration" step="any" tabindex="201"></td>
                            <td><input type="number" class="total" min="1" tabindex="202"></td>
                            <td><input type="number" class="dead" min="0" tabindex="203"></td>
                            <td><span class="mortality-display">--</span></td>
                        </tr>
                    </tbody>
                </table>
                <button id="add-row-btn-3" class="button primary-button">新增數據列</button>
            </div>
        </div>

        <hr>

        <div class="actions">
            <button id="calculate-btn" class="button accent-button">計算 LC 值</button>
            <button id="export-pdf-btn" class="button secondary-button" style="display: none;">匯出完整報告</button>
            <button id="reset-btn" class="button secondary-button">重設</button>
        </div>

        <div class="results-section" id="results-section" style="display: none;">
            <div class="results-info">
                <h3>計算結果</h3>
                <div id="results-group-1">
                    <h4 id="results-title-1">第一組數據 (實驗組 A)</h4>
                    <div class="data-stats">
                        <div class="stat-card">
                            <h5>LC50</h5>
                            <div class="stat-value" id="lc50-result-1">--</div>
                            <div class="confidence-interval" id="lc50-ci-1">--</div>
                        </div>
                        <div class="stat-card">
                            <h5>LC75</h5>
                            <div class="stat-value" id="lc75-result-1">--</div>
                        </div>
                        <div class="stat-card">
                            <h5>LC90</h5>
                            <div class="stat-value" id="lc90-result-1">--</div>
                        </div>
                        <div class="stat-card">
                            <h5>回歸線斜率 (b)</h5>
                            <div class="stat-value" id="slope-result-1">--</div>
                        </div>
                    </div>
                </div>
                <div id="results-group-2" style="display:none;">
                    <h4 id="results-title-2">第二組數據 (實驗組 B)</h4>
                    <div class="data-stats">
                        <div class="stat-card">
                            <h5>LC50</h5>
                            <div class="stat-value" id="lc50-result-2">--</div>
                            <div class="confidence-interval" id="lc50-ci-2">--</div>
                        </div>
                        <div class="stat-card">
                            <h5>LC75</h5>
                            <div class="stat-value" id="lc75-result-2">--</div>
                        </div>
                        <div class="stat-card">
                            <h5>LC90</h5>
                            <div class="stat-value" id="lc90-result-2">--</div>
                        </div>
                        <div class="stat-card">
                            <h5>回歸線斜率 (b)</h5>
                            <div class="stat-value" id="slope-result-2">--</div>
                        </div>
                    </div>
                </div>
                <div id="results-group-3" style="display:none;">
                    <h4 id="results-title-3">第三組數據 (實驗組 C)</h4>
                    <div class="data-stats">
                        <div class="stat-card">
                            <h5>LC50</h5>
                            <div class="stat-value" id="lc50-result-3">--</div>
                            <div class="confidence-interval" id="lc50-ci-3">--</div>
                        </div>
                        <div class="stat-card">
                            <h5>LC75</h5>
                            <div class="stat-value" id="lc75-result-3">--</div>
                        </div>
                        <div class="stat-card">
                            <h5>LC90</h5>
                            <div class="stat-value" id="lc90-result-3">--</div>
                        </div>
                        <div class="stat-card">
                            <h5>回歸線斜率 (b)</h5>
                            <div class="stat-value" id="slope-result-3">--</div>
                        </div>
                    </div>
                </div>
                
                <div class="validation-info" id="validation-info">
                    <h4>統計驗證</h4>
                    <div id="validation-details">--</div>
                </div>
            </div>
            
            <div class="chart-container">
                <canvas id="probit-chart"></canvas>
                <div class="chart-export-section">
                    <h4>圖表匯出</h4>
                    <div class="chart-export-buttons">
                        <button id="export-png-btn" class="export-btn export-png-btn">匯出 PNG</button>
                        <button id="export-jpg-btn" class="export-btn export-jpg-btn">匯出 JPG</button>
                        <button id="export-svg-btn" class="export-btn export-svg-btn">匯出 SVG</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="js/fonts/NotoSansTC-normal.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/10.6.4/math.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jstat/1.9.5/jstat.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const unitSelect = document.getElementById('unit-select');
            const customUnitInput = document.getElementById('custom-unit-input');
            const dataTable1 = document.getElementById('data-table-1');
            const dataTable2 = document.getElementById('data-table-2');
            const dataTable3 = document.getElementById('data-table-3');
            const addRowBtn1 = document.getElementById('add-row-btn-1');
            const addRowBtn2 = document.getElementById('add-row-btn-2');
            const addRowBtn3 = document.getElementById('add-row-btn-3');
            const calculateBtn = document.getElementById('calculate-btn');
            const exportPdfBtn = document.getElementById('export-pdf-btn');
            const exportPngBtn = document.getElementById('export-png-btn');
            const exportJpgBtn = document.getElementById('export-jpg-btn');
            const exportSvgBtn = document.getElementById('export-svg-btn');
            const resetBtn = document.getElementById('reset-btn');
            const resultsSection = document.getElementById('results-section');
            const resultsGroup1 = document.getElementById('results-group-1');
            const resultsGroup2 = document.getElementById('results-group-2');
            const resultsGroup3 = document.getElementById('results-group-3');
            const validationInfo = document.getElementById('validation-info');
            const validationDetails = document.getElementById('validation-details');
            
            // 組名輸入框
            const group1NameInput = document.getElementById('group1-name');
            const group2NameInput = document.getElementById('group2-name');
            const group3NameInput = document.getElementById('group3-name');
            
            let probitChart;

            // 更新組名顯示
            function updateGroupNames() {
                document.getElementById('group1-title').textContent = `第一組數據 (${group1NameInput.value})`;
                document.getElementById('group2-title').textContent = `第二組數據 (${group2NameInput.value}) - 可選`;
                document.getElementById('group3-title').textContent = `第三組數據 (${group3NameInput.value}) - 可選`;
                
                document.getElementById('results-title-1').textContent = `第一組數據 (${group1NameInput.value})`;
                document.getElementById('results-title-2').textContent = `第二組數據 (${group2NameInput.value})`;
                document.getElementById('results-title-3').textContent = `第三組數據 (${group3NameInput.value})`;
            }
            
            // 監聽組名變更
            group1NameInput.addEventListener('input', updateGroupNames);
            group2NameInput.addEventListener('input', updateGroupNames);
            group3NameInput.addEventListener('input', updateGroupNames);
            
            // 初始化組名
            updateGroupNames();

            // 處理自訂單位輸入框的顯示
            unitSelect.addEventListener('change', () => {
                if (unitSelect.value === 'custom') {
                    customUnitInput.style.display = 'inline-block';
                } else {
                    customUnitInput.style.display = 'none';
                }
            });

            // 鍵盤導航功能
            function setupKeyboardNavigation() {
                const allInputs = document.querySelectorAll('.data-table input[type="number"]');
                
                allInputs.forEach((input, index) => {
                    input.addEventListener('keydown', (e) => {
                        let nextIndex = -1;
                        
                        switch(e.key) {
                            case 'ArrowDown':
                                e.preventDefault();
                                nextIndex = findNextRowInput(input, 1);
                                break;
                            case 'ArrowUp':
                                e.preventDefault();
                                nextIndex = findNextRowInput(input, -1);
                                break;
                            case 'ArrowRight':
                            case 'Tab':
                                if (e.key === 'Tab' && e.shiftKey) break;
                                e.preventDefault();
                                nextIndex = findNextColumnInput(input, 1);
                                break;
                            case 'ArrowLeft':
                                e.preventDefault();
                                nextIndex = findNextColumnInput(input, -1);
                                break;
                            case 'Enter':
                                e.preventDefault();
                                nextIndex = findNextRowInput(input, 1);
                                break;
                        }
                        
                        if (nextIndex !== -1) {
                            const nextInput = document.querySelectorAll('.data-table input[type="number"]')[nextIndex];
                            if (nextInput) {
                                nextInput.focus();
                                nextInput.select();
                            }
                        }
                    });
                    
                    // 視覺反饋
                    input.addEventListener('focus', () => {
                        input.classList.add('keyboard-focused');
                    });
                    
                    input.addEventListener('blur', () => {
                        input.classList.remove('keyboard-focused');
                    });
                });
            }
            
            function findNextRowInput(currentInput, direction) {
                const allInputs = Array.from(document.querySelectorAll('.data-table input[type="number"]'));
                const currentIndex = allInputs.indexOf(currentInput);
                const currentRow = currentInput.closest('tr');
                const currentTable = currentInput.closest('table');
                const currentColumn = Array.from(currentRow.querySelectorAll('input[type="number"]')).indexOf(currentInput);
                
                let nextRow;
                if (direction > 0) {
                    nextRow = currentRow.nextElementSibling;
                    if (!nextRow) {
                        // 尋找下一個表格的第一行
                        let nextTable = currentTable.parentNode;
                        while (nextTable && nextTable.nextElementSibling) {
                            nextTable = nextTable.nextElementSibling;
                            const foundTable = nextTable.querySelector('.data-table');
                            if (foundTable) {
                                nextRow = foundTable.querySelector('tbody tr');
                                break;
                            }
                        }
                    }
                } else {
                    nextRow = currentRow.previousElementSibling;
                    if (!nextRow) {
                        // 尋找上一個表格的最後一行
                        let prevTable = currentTable.parentNode;
                        while (prevTable && prevTable.previousElementSibling) {
                            prevTable = prevTable.previousElementSibling;
                            const foundTable = prevTable.querySelector('.data-table');
                            if (foundTable) {
                                const rows = foundTable.querySelectorAll('tbody tr');
                                nextRow = rows[rows.length - 1];
                                break;
                            }
                        }
                    }
                }
                
                if (nextRow) {
                    const nextInput = nextRow.querySelectorAll('input[type="number"]')[currentColumn];
                    if (nextInput) {
                        const nextIndex = allInputs.indexOf(nextInput);
                        return nextIndex;
                    }
                }
                
                return -1;
            }
            
            function findNextColumnInput(currentInput, direction) {
                const allInputs = Array.from(document.querySelectorAll('.data-table input[type="number"]'));
                const currentIndex = allInputs.indexOf(currentInput);
                const currentRow = currentInput.closest('tr');
                const rowInputs = Array.from(currentRow.querySelectorAll('input[type="number"]'));
                const currentColumn = rowInputs.indexOf(currentInput);
                
                let nextInput;
                if (direction > 0) {
                    if (currentColumn < rowInputs.length - 1) {
                        nextInput = rowInputs[currentColumn + 1];
                    } else {
                        // 移到下一行的第一列
                        return findNextRowInput(currentInput, 1);
                    }
                } else {
                    if (currentColumn > 0) {
                        nextInput = rowInputs[currentColumn - 1];
                    } else {
                        // 移到上一行的最後一列
                        const prevRowIndex = findNextRowInput(currentInput, -1);
                        if (prevRowIndex !== -1) {
                            const prevInput = allInputs[prevRowIndex];
                            const prevRow = prevInput.closest('tr');
                            const prevRowInputs = Array.from(prevRow.querySelectorAll('input[type="number"]'));
                            nextInput = prevRowInputs[prevRowInputs.length - 1];
                        }
                    }
                }
                
                if (nextInput) {
                    return allInputs.indexOf(nextInput);
                }
                
                return -1;
            }

            // 新增數據列
            addRowBtn1.addEventListener('click', () => addRow(dataTable1.querySelector('tbody'), 1));
            addRowBtn2.addEventListener('click', () => addRow(dataTable2.querySelector('tbody'), 2));
            addRowBtn3.addEventListener('click', () => addRow(dataTable3.querySelector('tbody'), 3));

            function addRow(tableBody, groupNum) {
                const rowCount = tableBody.children.length;
                const baseTabIndex = groupNum * 100 + rowCount * 10;
                const newRow = tableBody.insertRow();
                newRow.innerHTML = `
                    <td><input type="number" class="concentration" step="any" tabindex="${baseTabIndex + 1}"></td>
                    <td><input type="number" class="total" min="1" tabindex="${baseTabIndex + 2}"></td>
                    <td><input type="number" class="dead" min="0" tabindex="${baseTabIndex + 3}"></td>
                    <td><span class="mortality-display">--</span></td>
                `;
                attachInputListeners(newRow);
                setupKeyboardNavigation();
            }

            // 附加輸入監聽器來自動計算死亡率
            function attachInputListeners(row) {
                const totalInput = row.querySelector('.total');
                const deadInput = row.querySelector('.dead');
                const mortalityDisplay = row.querySelector('.mortality-display');

                function updateMortality() {
                    const total = parseInt(totalInput.value);
                    const dead = parseInt(deadInput.value);
                    if (!isNaN(total) && !isNaN(dead) && total > 0) {
                        if (dead > total) {
                            deadInput.value = total;
                        }
                        const mortality = (parseInt(deadInput.value) / total * 100).toFixed(1);
                        mortalityDisplay.textContent = mortality + '%';
                    } else {
                        mortalityDisplay.textContent = '--';
                    }
                }

                totalInput.addEventListener('input', updateMortality);
                deadInput.addEventListener('input', updateMortality);
            }

            // 初始化現有行的監聽器和鍵盤導航
            document.querySelectorAll('.data-table tbody tr').forEach(attachInputListeners);
            setupKeyboardNavigation();

            // 處理 Excel 貼上功能
            document.querySelectorAll('.data-table').forEach(table => {
                table.addEventListener('paste', (event) => {
                    const tableBody = table.querySelector('tbody');
                    let pasteData = event.clipboardData.getData('text/plain');
                    let rows = pasteData.trim().split('\n');
                    
                    // 清空現有表格內容
                    tableBody.innerHTML = '';
                    
                    const tableId = table.id;
                    const groupNum = parseInt(tableId.split('-')[2]);

                    rows.forEach((rowString, index) => {
                        const cols = rowString.trim().split(/[\t\s]+/);
                        if (cols.length >= 3) {
                            const baseTabIndex = groupNum * 100 + index * 10;
                            const newRow = tableBody.insertRow();
                            const concentration = parseFloat(cols[0]);
                            const total = parseInt(cols[1]);
                            const dead = parseInt(cols[2]);
                            const mortality = (!isNaN(total) && !isNaN(dead) && total > 0) ? (dead / total * 100).toFixed(1) : '--';
                            
                            newRow.innerHTML = `
                                <td><input type="number" class="concentration" step="any" value="${cols[0]}" tabindex="${baseTabIndex + 1}"></td>
                                <td><input type="number" class="total" min="1" value="${cols[1]}" tabindex="${baseTabIndex + 2}"></td>
                                <td><input type="number" class="dead" min="0" value="${cols[2]}" tabindex="${baseTabIndex + 3}"></td>
                                <td><span class="mortality-display">${mortality}%</span></td>
                            `;
                            attachInputListeners(newRow);
                        }
                    });
                    setupKeyboardNavigation();
                    event.preventDefault();
                });
            });

            // 重設按鈕功能
            resetBtn.addEventListener('click', () => {
                dataTable1.querySelector('tbody').innerHTML = `<tr><td><input type="number" class="concentration" step="any" tabindex="1"></td><td><input type="number" class="total" min="1" tabindex="2"></td><td><input type="number" class="dead" min="0" tabindex="3"></td><td><span class="mortality-display">--</span></td></tr>`;
                dataTable2.querySelector('tbody').innerHTML = `<tr><td><input type="number" class="concentration" step="any" tabindex="101"></td><td><input type="number" class="total" min="1" tabindex="102"></td><td><input type="number" class="dead" min="0" tabindex="103"></td><td><span class="mortality-display">--</span></td></tr>`;
                dataTable3.querySelector('tbody').innerHTML = `<tr><td><input type="number" class="concentration" step="any" tabindex="201"></td><td><input type="number" class="total" min="1" tabindex="202"></td><td><input type="number" class="dead" min="0" tabindex="203"></td><td><span class="mortality-display">--</span></td></tr>`;
                
                // 重新附加監聽器
                document.querySelectorAll('.data-table tbody tr').forEach(attachInputListeners);
                setupKeyboardNavigation();
                
                resultsSection.style.display = 'none';
                resultsGroup2.style.display = 'none';
                resultsGroup3.style.display = 'none';
                exportPdfBtn.style.display = 'none';
                
                if (probitChart) {
                    probitChart.destroy();
                }
            });

            // 主要計算功能
            calculateBtn.addEventListener('click', () => {
                try {
                    const data1 = getDataFromTable(dataTable1);
                    const data2 = getDataFromTable(dataTable2);
                    const data3 = getDataFromTable(dataTable3);

                    if (data1.length < 3) {
                        showError('第一組數據請至少輸入三組有效數據以確保統計計算的可靠性。');
                        return;
                    }

                    // 驗證數據質量
                    const validation1 = validateData(data1);
                    if (!validation1.isValid) {
                        showError(`第一組數據驗證失敗：${validation1.message}`);
                        return;
                    }

                    const probitResults1 = calculateProbit(data1);
                    displayResults(probitResults1, 1);
                    
                    let datasets = createChartDatasets(data1, probitResults1, 1);
                    let validationText = `${group1NameInput.value}：${validation1.message}`;

                    if (data2.length >= 3) {
                        const validation2 = validateData(data2);
                        if (validation2.isValid) {
                            const probitResults2 = calculateProbit(data2);
                            displayResults(probitResults2, 2);
                            datasets = datasets.concat(createChartDatasets(data2, probitResults2, 2));
                            validationText += `<br>${group2NameInput.value}：${validation2.message}`;
                            resultsGroup2.style.display = 'block';
                        } else {
                            validationText += `<br>${group2NameInput.value}：驗證失敗 - ${validation2.message}`;
                        }
                    }

                    if (data3.length >= 3) {
                        const validation3 = validateData(data3);
                        if (validation3.isValid) {
                            const probitResults3 = calculateProbit(data3);
                            displayResults(probitResults3, 3);
                            datasets = datasets.concat(createChartDatasets(data3, probitResults3, 3));
                            validationText += `<br>${group3NameInput.value}：${validation3.message}`;
                            resultsGroup3.style.display = 'block';
                        } else {
                            validationText += `<br>${group3NameInput.value}：驗證失敗 - ${validation3.message}`;
                        }
                    }

                    showSuccess('計算成功！');
                    validationDetails.innerHTML = validationText;
                    resultsSection.style.display = 'block';
                    exportPdfBtn.style.display = 'block';
                    
                    renderChart(datasets);
                } catch (e) {
                    showError(`發生計算錯誤：${e.message}`);
                    console.error(e);
                }
            });
            
            // 從表格中獲取數據
            function getDataFromTable(table) {
                const data = [];
                const rows = table.querySelectorAll('tbody tr');
                rows.forEach(row => {
                    const concentration = row.querySelector('.concentration').value;
                    const total = row.querySelector('.total').value;
                    const dead = row.querySelector('.dead').value;
                    if (concentration && total && dead) {
                        data.push({
                            concentration: parseFloat(concentration),
                            total: parseInt(total),
                            dead: parseInt(dead)
                        });
                    }
                });
                return data;
            }

            // 數據驗證
            function validateData(data) {
                const concentrations = data.map(d => d.concentration);
                const mortalities = data.map(d => (d.dead / d.total) * 100);
                
                const hasZeroMortality = mortalities.includes(0);
                const hasHundredMortality = mortalities.includes(100);
                
                if (hasZeroMortality && hasHundredMortality) {
                    return { isValid: false, message: '數據不能同時包含 0% 和 100% 死亡率，請修正。' };
                }
                
                // 檢查濃度值是否遞增
                for (let i = 0; i < concentrations.length - 1; i++) {
                    if (concentrations[i] >= concentrations[i+1]) {
                        return { isValid: false, message: '濃度值必須為嚴格遞增排序，請檢查您的輸入。' };
                    }
                }
                
                return { 
                    isValid: true, 
                    message: `數據驗證通過，共 ${data.length} 個有效數據點，濃度範圍: ${math.min(concentrations).toFixed(2)}-${math.max(concentrations).toFixed(2)}, 死亡率範圍: ${math.min(mortalities).toFixed(1)}%-${math.max(mortalities).toFixed(1)}%` 
                };
            }

            // 主要 Probit 計算邏輯
            function calculateProbit(data) {
                // 數據轉換和修正 (Finney's method)
                const transformedData = data.map(d => {
                    let correctedMortality = d.dead;
                    if (d.dead === 0) {
                        correctedMortality = 0.5;
                    } else if (d.dead === d.total) {
                        correctedMortality = d.total - 0.5;
                    }
                    
                    const p = correctedMortality / d.total;
                    return {
                        x: math.log10(d.concentration),
                        y: jStat.probit(p),
                        n: d.total,
                        dead: d.dead,
                        p: p
                    };
                });
                
                const xValues = transformedData.map(d => d.x);
                const yValues = transformedData.map(d => d.y);
                const nValues = transformedData.map(d => d.n);
                
                // 加權最小平方法迴歸 WLS
                let a = 0, b = 0, sumW = 0, sumWx = 0, sumWy = 0, sumWxy = 0, sumWxx = 0;
                const weights = transformedData.map(d => {
                    const z = (d.y === Infinity) ? 4.9 : jStat.normal.pdf(d.y, 0, 1);
                    const q = 1 - d.p;
                    return (d.n * math.pow(z, 2)) / (d.p * q);
                });

                for (let i = 0; i < transformedData.length; i++) {
                    const d = transformedData[i];
                    const w = weights[i];
                    sumW += w;
                    sumWx += w * d.x;
                    sumWy += w * d.y;
                    sumWxy += w * d.x * d.y;
                    sumWxx += w * d.x * d.x;
                }
                
                b = (sumWxy - (sumWx * sumWy) / sumW) / (sumWxx - (sumWx * sumWx) / sumW);
                a = (sumWy / sumW) - b * (sumWx / sumW);
                
                // 計算 LC50、LC75、LC90
                const lc50 = math.pow(10, (5 - a) / b);
                const lc75 = math.pow(10, (5.67 - a) / b);
                const lc90 = math.pow(10, (6.28 - a) / b);
                
                // 計算 95% 信賴區間
                // (參考 Finney, 1971)
                const sY = math.sqrt(math.sum(weights.map((w, i) => w * math.pow(yValues[i] - (a + b * xValues[i]), 2))) / (transformedData.length - 2));
                const v = 1 / sumW + math.pow((5 - sumWy / sumW) / b, 2) / (sumWxx - math.pow(sumWx, 2) / sumW);
                const f = math.pow(b, 2) / (math.pow(b, 2) - math.pow(1.96 * sY, 2) * v);
                const lcl = math.pow(10, (5 - a - 1.96 * sY * math.sqrt(v)) / b);
                const ucl = math.pow(10, (5 - a + 1.96 * sY * math.sqrt(v)) / b);
                const ci = `${lcl.toFixed(3)}-${ucl.toFixed(3)}`;
                
                // 統計驗證: 卡方檢定 (Chi-Square Test)
                let chiSquare = 0;
                for (let i = 0; i < transformedData.length; i++) {
                    const d = transformedData[i];
                    const expectedProbit = a + b * d.x;
                    const expectedP = jStat.normal.cdf(expectedProbit, 0, 1);
                    const expectedDead = d.total * expectedP;
                    
                    if (expectedDead > 0 && expectedDead < d.total) {
                        chiSquare += math.pow(d.dead - expectedDead, 2) / expectedDead;
                        chiSquare += math.pow((d.total - d.dead) - (d.total - expectedDead), 2) / (d.total - expectedDead);
                    }
                }
                const degreesOfFreedom = transformedData.length - 2;
                const pValue = jStat.chisquare.cdf(chiSquare, degreesOfFreedom);
                const chiSquareTest = {
                    chiSquare: chiSquare.toFixed(4),
                    df: degreesOfFreedom,
                    p: pValue.toFixed(4)
                };
                
                return { a, b, lc50, lc75, lc90, ci, chiSquareTest };
            }

            // 顯示結果到 HTML
            function displayResults(results, groupNum) {
                document.getElementById(`lc50-result-${groupNum}`).textContent = `${results.lc50.toFixed(3)} ${getUnit()}`;
                document.getElementById(`lc50-ci-${groupNum}`).textContent = `95% CI: ${results.ci} ${getUnit()}`;
                document.getElementById(`lc75-result-${groupNum}`).textContent = `${results.lc75.toFixed(3)} ${getUnit()}`;
                document.getElementById(`lc90-result-${groupNum}`).textContent = `${results.lc90.toFixed(3)} ${getUnit()}`;
                document.getElementById(`slope-result-${groupNum}`).textContent = `${results.b.toFixed(3)}`;
            }

            // 獲取當前濃度單位
            function getUnit() {
                const unitSelect = document.getElementById('unit-select');
                const customUnitInput = document.getElementById('custom-unit-input');
                return unitSelect.value === 'custom' ? customUnitInput.value : unitSelect.value;
            }

            // 渲染圖表
            function renderChart(datasets) {
                if (probitChart) {
                    probitChart.destroy();
                }
                const ctx = document.getElementById('probit-chart').getContext('2d');
                probitChart = new Chart(ctx, {
                    type: 'scatter',
                    data: {
                        datasets: datasets
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: {
                                type: 'logarithmic',
                                title: {
                                    display: true,
                                    text: `濃度 (${getUnit()})`,
                                    font: {
                                        size: 14,
                                        weight: 'bold'
                                    }
                                },
                                ticks: {
                                    callback: function(value, index, values) {
                                        if (value >= 1) {
                                            return value;
                                        }
                                        return null;
                                    }
                                }
                            },
                            y: {
                                type: 'linear',
                                title: {
                                    display: true,
                                    text: '死亡率 (%) / Probit',
                                    font: {
                                        size: 14,
                                        weight: 'bold'
                                    }
                                },
                                min: 0,
                                max: 100,
                                ticks: {
                                    callback: function(value, index, values) {
                                        if (value === 0) return '0%';
                                        if (value === 10) return '10%';
                                        if (value === 20) return '20%';
                                        if (value === 30) return '30%';
                                        if (value === 40) return '40%';
                                        if (value === 50) return '50%';
                                        if (value === 60) return '60%';
                                        if (value === 70) return '70%';
                                        if (value === 80) return '80%';
                                        if (value === 90) return '90%';
                                        if (value === 100) return '100%';
                                        
                                        // 添加 Probit 軸
                                        const probitValues = [2.67, 2.95, 3.25, 3.72, 4.18, 4.75, 5.0, 5.25, 5.67, 6.28, 7.33];
                                        const probitMapping = [0, 1, 2, 5, 10, 20, 30, 40, 50, 60, 70, 80, 90, 95, 98, 99];
                                        if (probitMapping.includes(value)) {
                                            const probit = jStat.probit(value / 100);
                                            return `${value}% / ${probit.toFixed(2)}`;
                                        }
                                        return `${value}%`;
                                    }
                                }
                            }
                        },
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        let label = context.dataset.label || '';
                                        if (label) {
                                            label += ': ';
                                        }
                                        label += `濃度: ${context.parsed.x.toFixed(2)} ${getUnit()}, 死亡率: ${context.parsed.y.toFixed(1)}%`;
                                        return label;
                                    }
                                }
                            }
                        }
                    }
                });
            }

            // 建立 Chart.js 數據集
            function createChartDatasets(data, results, groupNum) {
                const datasets = [];
                const groupName = document.getElementById(`group${groupNum}-name`).value;
                const colors = ['#667eea', '#38ef7d', '#f39c12'];
                const dataPoints = data.map(d => ({
                    x: d.concentration,
                    y: (d.dead / d.total) * 100
                }));

                datasets.push({
                    label: `實驗數據點 (${groupName})`,
                    data: dataPoints,
                    borderColor: colors[groupNum - 1],
                    backgroundColor: colors[groupNum - 1],
                    pointRadius: 6,
                    pointStyle: 'crossRot',
                    type: 'scatter'
                });

                // 添加回歸線數據
                const regressionLine = [];
                const minConc = math.min(data.map(d => d.concentration));
                const maxConc = math.max(data.map(d => d.concentration));
                
                for (let i = 0; i <= 100; i += 1) {
                    const probitValue = jStat.probit(i / 100);
                    const concentration = math.pow(10, (probitValue - results.a) / results.b);
                    regressionLine.push({ x: concentration, y: i });
                }

                datasets.push({
                    label: `Probit 回歸線 (${groupName})`,
                    data: regressionLine,
                    borderColor: colors[groupNum - 1],
                    borderDash: [5, 5],
                    fill: false,
                    showLine: true,
                    pointRadius: 0,
                    pointHoverRadius: 0,
                    type: 'line',
                    yAxisID: 'y'
                });
                
                return datasets;
            }

            // 顯示錯誤和成功訊息
            function showError(message) {
                const messageDiv = document.createElement('div');
                messageDiv.className = 'error-message';
                messageDiv.innerHTML = `<strong>錯誤:</strong> ${message}`;
                document.body.appendChild(messageDiv);
                setTimeout(() => messageDiv.remove(), 5000);
            }

            function showSuccess(message) {
                const messageDiv = document.createElement('div');
                messageDiv.className = 'success-message';
                messageDiv.innerHTML = `<strong>成功:</strong> ${message}`;
                document.body.appendChild(messageDiv);
                setTimeout(() => messageDiv.remove(), 5000);
            }

            // PDF 匯出功能 (使用 jsPDF 和 html2canvas)
            exportPdfBtn.addEventListener('click', () => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF('p', 'mm', 'a4');
                const unit = getUnit();
                
                // 載入字型
                doc.addFileToVFS('NotoSansTC-normal.ttf', NotoSansTC_normal);
                doc.addFont('NotoSansTC-normal.ttf', 'NotoSansTC', 'normal');
                doc.setFont('NotoSansTC');
                
                // 標題
                doc.setFontSize(22);
                doc.text('LC50/LC75/LC90 分析報告', 105, 20, null, null, "center");
                doc.setFontSize(10);
                doc.text(`生成時間: ${new Date().toLocaleString('zh-TW')}`, 105, 26, null, null, "center");

                let yPosition = 40;

                // 處理多組數據
                const groupsToExport = [1, 2, 3].filter(num => document.getElementById(`results-group-${num}`).style.display !== 'none');
                
                groupsToExport.forEach(groupNum => {
                    const tableId = `data-table-${groupNum}`;
                    const groupTitle = document.getElementById(`group${groupNum}-title`).textContent;
                    
                    // 標題
                    doc.setFontSize(16);
                    doc.text(`${groupTitle} 實驗數據`, 20, yPosition);
                    yPosition += 10;
                    
                    const headers = [
                        { content: "濃度", dataKey: "concentration" },
                        { content: "總數", dataKey: "total" },
                        { content: "死亡數", dataKey: "dead" },
                        { content: "死亡率(%)", dataKey: "mortality" }
                    ];

                    const dataRows = getDataFromTable(document.getElementById(tableId)).map(row => {
                        const mortality = (row.dead / row.total * 100).toFixed(1);
                        return {
                            concentration: row.concentration,
                            total: row.total,
                            dead: row.dead,
                            mortality: `${mortality}%`
                        };
                    });

                    doc.autoTable({
                        startY: yPosition,
                        head: [headers.map(h => h.content)],
                        body: dataRows.map(d => Object.values(d)),
                        headStyles: {
                            fillColor: [102, 126, 234],
                            textColor: [255, 255, 255],
                            font: 'NotoSansTC',
                            fontStyle: 'normal'
                        },
                        styles: {
                            font: 'NotoSansTC',
                            fontSize: 10,
                            cellPadding: 3,
                            valign: 'middle',
                            halign: 'center'
                        },
                        margin: { left: 20, right: 20 },
                        theme: 'grid',
                        didDrawPage: function(data) {
                            yPosition = data.cursor.y + 10;
                        }
                    });

                    // 插入計算結果
                    const results = document.getElementById(`results-group-${groupNum}`);
                    doc.setFontSize(14);
                    doc.text(`${results.querySelector('h4').textContent}:`, 20, yPosition);
                    yPosition += 8;

                    const lc50 = results.querySelector(`#lc50-result-${groupNum}`).textContent;
                    const lc50Ci = results.querySelector(`#lc50-ci-${groupNum}`).textContent;
                    const lc75 = results.querySelector(`#lc75-result-${groupNum}`).textContent;
                    const lc90 = results.querySelector(`#lc90-result-${groupNum}`).textContent;
                    const slope = results.querySelector(`#slope-result-${groupNum}`).textContent;

                    doc.setFontSize(12);
                    doc.text(`LC50: ${lc50}`, 20, yPosition);
                    doc.text(lc50Ci, 20, yPosition + 6);
                    doc.text(`LC75: ${lc75}`, 20, yPosition + 12);
                    doc.text(`LC90: ${lc90}`, 20, yPosition + 18);
                    doc.text(`回歸線斜率: ${slope}`, 20, yPosition + 24);
                    yPosition += 30;

                    if (yPosition > 240) {
                        doc.addPage();
                        yPosition = 20;
                    }
                });

                // 統計驗證
                doc.setFontSize(16);
                doc.text('統計驗證', 20, yPosition);
                yPosition += 8;
                doc.setFont('NotoSansTC');
                doc.setFontSize(10);
                const validationText = validationDetails.innerHTML.replace(/<br>/g, '\n').replace(/<[^>]*>/g, '');
                const splitText = doc.splitTextToSize(validationText, 170);
                doc.text(splitText, 20, yPosition);
                yPosition += splitText.length * 5 + 10;
                
                // 添加圖表
                if (yPosition > 220) {
                    doc.addPage();
                    yPosition = 20;
                }
                
                doc.setFont('NotoSansTC');
                doc.setFontSize(12);
                doc.text('Probit 分析圖', 20, yPosition);
                
                html2canvas(document.getElementById('probit-chart')).then(canvas => {
                    const imgData = canvas.toDataURL('image/png');
                    const imgWidth = 170;
                    const imgHeight = canvas.height * imgWidth / canvas.width;
                    
                    if (yPosition + imgHeight > 280) {
                        doc.addPage();
                        yPosition = 20;
                    }
                    
                    doc.addImage(imgData, 'PNG', 20, yPosition + 10, imgWidth, imgHeight);
                    doc.save('LC50_Analysis_Report.pdf');
                });
            });
        });
    </script>
</body>
</html>
